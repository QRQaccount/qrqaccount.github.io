---
title: 使用C实现协程(二)
date: 2020-08-28 22:12:11
tags:
- C
- 协程
categories:
- 使用C实现协程
---
# 使用C实现协程(二)

## 协程的组成结构

协程的基本组成部分可以分为以下这些

<!-- more -->

### 调度器

用以调度各个协程

### 协程

我们将协程分为主协程和普通协程.普通协程由主协程或其他普通协程创建

#### 协程私有栈

用于保存协程数据的私有栈。

### 协程共享栈

一块单独分配出来的空间，当协程以使用共享栈的方式创建的时候，会使用共享栈。在协程间进行切换的时候会将其中的数据换出再换如正在运行的协程的数据

### 协程控制块

每个协程都有一个结构体变量用于记录协程的基本信息
* 协程的名称
* 协程的编号
* 协程所对应的主协程
* 协程的栈空间的分配方式
* 协程的栈的范围
* 协程的函数指针

## 实现的API

- coroutine_init 创建一个主协程并返回控制块句柄
- coroutine_remuse 唤醒一个指定的被挂起的协程
- coroutine_yeild 挂起指定的协程
- coroutine_create 创建一个coroutine并返回协程控制块的句柄
- coroutine_status 查看指定的协程的状态
- coroutine_runing 返回目前正处于运行态的协程控制块句柄
- coroutine_delete 结束指定的协程，若使用共享栈则清空该协程在共享栈中占用的空间。若使用私有栈则释放私有栈空间。若指定的协程为主协程则会结束所有被这个主协程创建的普通协程并释放这些协程的私有栈空间